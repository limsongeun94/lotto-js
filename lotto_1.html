<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>로또당첨되세요~</title>
    <style>
      * {
        margin: 0;
        padding: 0;
      }

      .num_container {
        margin: 0 auto;
        box-sizing: border-box;
        width: 443px;
        padding-bottom: 12px;
      }

      .flex {
        display: flex;
        flex-wrap: wrap;
        padding: 12px;
        padding-left: 0;
      }

      .flex > div {
        margin-left: 12px;
      }

      .extract {
        width: 180px;
        height: 50px;
        font-size: 24px;
        cursor: pointer;
      }

      .extract:first-child {
        margin-right: 25px;
      }

      .number_box {
        margin: 0 auto;
        margin-bottom: 30px;
        width: 560px;
        box-sizing: border-box;
        border-collapse: collapse;
        border: 1px solid black;
      }

      .number_box th {
        padding: 8px;
        line-height: 2em;
      }

      .number_box td {
        padding: 8px;
        border-top: 1px solid black;
        font-size: 1.5em;
        line-height: 2em;
      }

      .ball-container {
        display: flex;
        justify-content: center;
      }

      .number-ball {
        background-color: rgb(239, 239, 239);
        border: 1px solid rgb(59, 59, 59);
        border-radius: 50%;
        width: 50px;
        height: 50px;
        margin-right: 10px;
      }

      .number-ball:last-child {
        margin-right: 0px;
      }
    </style>
  </head>
  <body>
    <h1 style="margin: 30px; text-align: center">로또 번호 추출기</h1>
    <fieldset class="num_container">
      <legend style="margin-left: 12px">포함할 번호</legend>
      <form>
        <div id="include_number" class="flex"></div>
        <div style="text-align: center">
          <button type="reset">초기화</button>
        </div>
      </form>
    </fieldset>
    <fieldset class="num_container">
      <legend style="margin-left: 12px">제외할 번호</legend>
      <form>
        <div id="except_number" class="flex"></div>
        <div style="text-align: center">
          <button type="reset">초기화</button>
        </div>
      </form>
    </fieldset>
    <div style="margin: 30px; text-align: center">
      <button class="extract" onclick="oneLottoArray()">한 줄 추출</button>
      <button class="extract" onclick="fiveLottoArray()">다섯 줄 추출</button>
    </div>
    <table class="number_box">
      <thead>
        <tr>
          <th>한 줄 번호 추출!</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td id="one" style="text-align: center"></td>
        </tr>
      </tbody>
    </table>
    <table class="number_box">
      <thead>
        <tr>
          <th>다섯 줄 번호 추출!</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td id="five" style="text-align: center"></td>
        </tr>
      </tbody>
    </table>
  </body>
  <script>
    let inClicked = new Array();
    let exClicked = new Array();

    function createNum(el, prefix) {
      for (let i = 1; i <= 45; i++) {
        let item = document.createElement("div");
        let label = document.createElement("label");
        let input = document.createElement("input");

        label.setAttribute("for", prefix + i);
        label.innerText = i < 10 ? "0" + i : i;
        input.setAttribute("type", "checkbox");
        input.setAttribute("value", i);
        input.id = prefix + i;
        input.name = input.id.substr(0, 3) === "ex_" ? "except" : "include";

        if (prefix == "in_") {
          input.onchange = (evt) => {
            // 체크 해제
            if (evt.target.checked == false) {
              inClicked = inClicked.filter((x) => x != i);
            }
            // 체크 시도
            else {
              // 체크 불가 1
              if (inClicked.length + 1 > 6) {
                alert("포함할 번호는 6개 넘게 선택할 수 없습니다.");
                evt.target.checked = false;
              }
              // 체크 불가 2
              else if (document.getElementById("ex_" + i).checked == true) {
                alert(
                  "제외할 번호와 같은 숫자의 포함할 번호는 선택할 수 없습니다."
                );
                evt.target.checked = false;
              }
              // 체크 가능
              else {
                inClicked.push(i);
              }
            }
            console.log(inClicked);
          };
        } else if (prefix == "ex_") {
          input.onchange = (evt) => {
            // 체크 해제
            if (evt.target.checked == false) {
              exClicked.filter((x) => x != i);
            }
            //체크시도
            else {
              // 체크불가1
              if (exClicked.length + 1 > 38) {
                alert("포함할 번호는 39개 넘게 선택할 수 없습니다.");
                evt.target.checked = false;
              }
              //체크불가2
              else if (document.getElementById("in_" + i).checked == true) {
                alert(
                  "포함할 번호와 같은 숫자의 제외할 번호는 선택할 수 없습니다."
                );
                evt.target.checked = false;
              }
              // 체크가능
              else {
                exClicked.push(i);
              }
            }
          };
        }

        item.appendChild(label);
        item.appendChild(input);
        el.appendChild(item);
      }
    }

    let include = document.getElementById("include_number");
    let except = document.getElementById("except_number");

    createNum(include, "in_");
    createNum(except, "ex_");

    let exName = document.getElementsByName("except");
    let inName = document.getElementsByName("include");

    // 만약 exName.value == inName.value 라면 방금 누른 input의 속성을 setAttribute로 ("onclick", "return false;")로 바꿔줄 것.
    // 만약 inName가 6개보다 많이 클릭되었으면 "포함할 번호는 6개 넘게 선택할 수 없습니다."라는 얼럿창을 띄우며 7번째 누른 input 속성을 setAttribute로 ("onclick", "return false;")로 바꿔줄 것.
    // 만약 exName가 39개보다 많이 클릭되었으면 "제외할 번호는 39개 넘게 선택할 수 없습니다."라는 얼럿창을 띄우며 40번째 누른 input 속성을 setAttribute로 ("onclick", "return false;")로 바꿔줄 것.

    function createLottoArr() {
      let lottoarray = new Array();

      let notInclude = Array.from(exName)
        .filter((el) => el.checked)
        .map((el) => parseInt(el.value));
      let isInclude = Array.from(inName)
        .filter((el) => el.checked)
        .map((el) => parseInt(el.value));

      lottoarray = lottoarray.concat(isInclude);

      let selectNum = isInclude.length;
      let rest = 6 - selectNum;
      for (i = 0; i < rest; i++) {
        let randomNum = Math.floor(Math.random() * 45) + 1;

        let condition1 = lottoarray.indexOf(randomNum) === -1;
        let condition2 = notInclude.indexOf(randomNum) === -1;

        if (
          // 여태껏 뽑은 번호 중 randomNum이 없는가
          condition1 &&
          // 사용자가 제외한 번호 중 randomNum이 없는가
          condition2
          // &&
          // condition3
        ) {
          lottoarray.push(randomNum);
          // 일단 푸시 메서드는 체이닝이 안돼... 푸시.푸시.푸시... 이렇게는 못써 ㅋㅋ
        } else {
          i--;
        }
      }
      return lottoarray;
    }

    function createNumberBallElement(numbers) {
      const container = document.createElement("div");
      container.classList.add("ball-container");
      const numberEls = numbers.map((x) => {
        const el = document.createElement("div");
        el.innerText = x;
        el.classList.add("number-ball");
        return el;
      });
      numberEls.forEach((el) => {
        container.appendChild(el);
      });
      return container;
    }

    function oneLottoArray() {
      const result = createLottoArr();
      const element = createNumberBallElement(result);

      // 이미 추출한 번호가 있다면 지우는 코드
      const prev = Array.from(
        document.getElementById("one").getElementsByClassName("ball-container")
      )[0];
      if (prev) prev.remove();
      //
      document.getElementById("one").appendChild(element);
    }

    function fiveLottoArray() {
      let results = [];
      for (a = 0; a < 5; a++) {
        results.push(createLottoArr());
      }

      const prev = Array.from(
        document.getElementById("five").getElementsByClassName("ball-container")
      );

      prev.forEach((container) => container.remove());

      results.forEach((result) => {
        const element = createNumberBallElement(result);
        document.getElementById("five").appendChild(element);
      });
    }

    // function oneLottoArray() {
    //     let lottoarray = new Array();
    //     for (i=0; i<6; i++) {
    //             let randomNum = Math.floor(Math.random()*45)+1;
    //             if(lottoarray.indexOf(randomNum) === -1) {
    //                 lottoarray.push(randomNum);
    //             } else {
    //                 i--;
    //             }
    //         }
    //     document.getElementById("one").innerText = lottoarray
    // }

    // function fiveLottoArray() {
    //     // document.getElementById("one").innerHTML 가 포문 안에 있으면 계속 새로운 값으로 갱신됨.
    //     //  그러니 for문 밖에 result라는 변수를 하나 선언해사
    //     let result = []
    //     for (a=0; a<5; a++) {
    //         let lottoarray = new Array();
    //         for (i=0; i<6; i++) {
    //             let randomNum = Math.floor(Math.random()*45)+1;
    //             if(lottoarray.indexOf(randomNum) === -1) {
    //                 lottoarray.push(randomNum);
    //             } else {
    //                 i--;
    //             }
    //         }
    //         // for문 안에 result 배열에 lottoarray 배열을 푸쉬해분 다음에
    //         result.push(lottoarray)
    //     }
    //     // 포문 바깥에서 딱 한번만 HTML에 삽입해주면 됨.
    //     document.getElementById("five").innerHTML = result.join("<br />")
    // }
  </script>
</html>
